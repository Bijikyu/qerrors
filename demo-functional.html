<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QErrors Functional Demo</title>
  <style>
    :root{--bg:#f6f8fc;--card:#fff;--primary:#667eea;--text:#1f2a44}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto;background:var(--bg);color:var(--text);margin:0}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,.05);border:1px solid #e9eefc;margin-bottom:20px}
    h1{font-size:1.4rem;margin:0 0 6px}
    h2{font-size:1.1rem;margin:0 0 12px}
    label{display:block;margin:6px 0 4px}
    input,select,textarea{width:100%;padding:10px;border:1px solid #d9e3f0;border-radius:6px;font-size:14px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .btn{padding:10px 14px;border-radius:8px;border:0;background:var(--primary);color:white;font-weight:600;cursor:pointer}
    .btn.secondary{background:#6c757d}
    .btn.ghost{background:transparent; color:#333; border:1px solid #ddd}
    .response{min-height:120px;border:1px solid #e6e6e6;background:#fff;padding:12px;border-radius:6px;white-space:pre-wrap;font-family:monospace}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width: 800px){.grid{grid-template-columns:1fr}}
    .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .metric{background:#f7f7fb;border:1px solid #e9e9f6;border-radius:8px;padding:12px;text-align:center}
    .metric .val{font-size:1.6rem;font-weight:700;color:var(--primary)}
  </style>
</head>
<body>
  <div class="container">
    <header class="card" style="margin-bottom:16px;">
      <h1>QErrors Functional Demo</h1>
      <p style="color:#555;margin:0 0 6px;">Self-contained frontend to exercise errors, AI analysis, and metrics without a backend.</p>
    </header>

    <section class="card" aria-label="Metrics">
      <h2>System Metrics</h2>
      <div class="metrics" id="metrics">
        <div class="metric"><div class="label">Total Errors</div><div class="val" id="m-total">0</div></div>
        <div class="metric"><div class="label">Queue Length</div><div class="val" id="m-queue">0</div></div>
        <div class="metric"><div class="label">Cache Hits</div><div class="val" id="m-cache">0</div></div>
        <div class="metric"><div class="label">AI Requests</div><div class="val" id="m-ai">0</div></div>
      </div>
    </section>

    <section class="card" aria-label="Error Testing">
      <h2>1) Error Testing</h2>
      <div class="grid">
        <div class="col">
          <label for="err-type">Error Type</label>
          <select id="err-type">
            <option value="validation">Validation</option>
            <option value="authentication">Authentication</option>
            <option value="authorization">Authorization</option>
            <option value="network">Network</option>
            <option value="system">System</option>
            <option value="database">Database</option>
          </select>
        </div>
        <div class="col">
          <label for="err-msg">Message</label>
          <input id="err-msg" placeholder="Enter error message" value="Test error message" />
        </div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn" onclick="triggerError()">Trigger Error</button>
        <button class="btn secondary" style="margin-left:8px" onclick="triggerCritical()">Trigger Critical</button>
        <button class="btn ghost" style="margin-left:8px" onclick="clearErrorOutput()">Clear</button>
      </div>
      <div class="response" id="err-output" style="margin-top:12px;">Response will appear here...</div>
    </section>

    <section class="card" aria-label="Custom Error">
      <h2>2) Custom Error</h2>
      <div class="grid">
        <div class="col"><label>Custom Name</label><input id="custom-name" value="CustomBusinessError"/></div>
        <div class="col"><label>Code</label><input id="custom-code" value="BUSINESS_RULE_VIOLATION"/></div>
        <div class="col"><label>Severity</label><select id="custom-sev"><option>low</option><option selected>medium</option><option>high</option><option>critical</option></select></div>
        <div class="col"><label>Context (JSON)</label><textarea id="custom-context" rows="2">{ "rule": "validation" }</textarea></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn" onclick="triggerCustomError()">Trigger Custom</button>
        <button class="btn ghost" style="margin-left:8px" onclick="clearCustomOutput()">Clear</button>
      </div>
      <div class="response" id="custom-output" style="margin-top:12px;">Output will appear here...</div>
    </section>

    <section class="card" aria-label="AI Analysis">
      <h2>3) AI Analysis</h2>
      <div class="grid">
        <div class="col"><label for="ai-scenario">Scenario</label><select id="ai-scenario"><option value="db">Database</option><option value="api">API</option><option value="memory">Memory</option></select></div>
        <div class="col"><label for="ai-provider">Provider</label><select id="ai-provider"><option value="openai">OpenAI</option><option value="google">Google Gemini</option><option value="anthropic">Anthropic</option></select></div>
      </div>
      <div class="row" style="margin-top:8px;">
        <button class="btn" onclick="triggerAIAnalysis()">Analyze</button>
        <button class="btn ghost" style="margin-left:8px" onclick="clearAIOutput()">Clear</button>
      </div>
      <div class="response" id="ai-output" style="margin-top:12px;">AI output will appear here...</div>
    </section>

    <section class="card" aria-label="Export & Reset">
      <h2>4) Actions</h2>
      <div class="row" style="margin-top:6px;">
        <button class="btn" onclick="exportLogs()">Export Logs</button>
        <button class="btn secondary" onclick="resetMetrics()" style="margin-left:8px">Reset Metrics</button>
      </div>
    </section>
  </div>

  <script>
    // local simple in-page state
    const metrics = { total:0, queue:0, cacheHits:0, aiRequests:0 };

    function updateMetricsUI(){
      document.getElementById('m-total').textContent = metrics.total;
      document.getElementById('m-queue').textContent = metrics.queue;
      document.getElementById('m-cache').textContent = metrics.cacheHits;
      document.getElementById('m-ai').textContent = metrics.aiRequests;
    }

    function triggerError(){
      const type = document.getElementById('err-type').value;
      const msg = document.getElementById('err-msg').value;
      const error = {
        type,
        message: msg,
        timestamp: new Date().toISOString(),
        severity: type,
      };
      document.getElementById('err-output').textContent = 'Processing...';
      setTimeout(()=>{
        metrics.total += 1; metrics.queue = Math.max(0, metrics.queue-1);
        const resp = { success:true, errorId:'ERR_'+Math.random().toString(36).slice(2,9).toUpperCase(), error, aiAdvice: { suggestion:'Check input formatting', confidence:90 } };
        document.getElementById('err-output').textContent = JSON.stringify(resp, null, 2);
        updateMetricsUI();
      }, 600);
    }
    function triggerCritical(){
      const type = 'system';
      const msg = 'Critical failure detected';
      document.getElementById('err-output').textContent = 'Processing...';
      setTimeout(()=>{
        metrics.total += 5; metrics.queue += 3;
        const resp = { success:false, errorId:'CRIT_'+Math.random().toString(36).slice(2,9).toUpperCase(), error:{ type, message: msg, severity:'critical' }, escalation:'CRITICAL' };
        document.getElementById('err-output').textContent = JSON.stringify(resp, null, 2);
        updateMetricsUI();
      }, 800);
    }
    function clearErrorOutput(){ document.getElementById('err-output').textContent = 'Response will appear here...'; }

    function triggerCustomError(){
      const name = document.getElementById('custom-name').value;
      const code = document.getElementById('custom-code').value;
      const sev = document.getElementById('custom-sev').value;
      const contextRaw = document.getElementById('custom-context').value;
      let context = {};
      try{ context = JSON.parse(contextRaw); } catch(e){ context = { parseError: e.message }; }
      const err = { name, code, message: `Custom error ${code}`, severity: sev, context };
      document.getElementById('custom-output').textContent = 'Processing...';
      setTimeout(()=>{
        metrics.total += 1; updateMetricsUI();
        const resp = { success:true, errorId:'CUST_'+Math.random().toString(36).slice(2,9).toUpperCase(), error: err, workflow:'custom_error_handler' };
        document.getElementById('custom-output').textContent = JSON.stringify(resp, null, 2);
      }, 700);
    }
    function clearCustomOutput(){ document.getElementById('custom-output').textContent = 'Output will appear here...'; }

    function triggerAIAnalysis(){
      const scenario = document.getElementById('ai-scenario').value;
      const provider = document.getElementById('ai-provider').value;
      document.getElementById('ai-output').textContent = 'Analyzing...';
      setTimeout(()=>{
        metrics.aiRequests += 1; updateMetricsUI();
        const analysis = { provider, scenario, analysis: {
          diagnosis: 'Simulated issue for '+scenario,
          suggestions: ['Check logs','Increase timeout','Enable fallback']
        }, confidence: Math.floor(Math.random()*20)+80, processingTime: Math.floor(Math.random()*900)+500, cost: '$0.01' };
        document.getElementById('ai-output').textContent = JSON.stringify(analysis, null, 2);
      }, 1200);
    }
    function clearAIOutput(){ document.getElementById('ai-output').textContent = 'AI output will appear here...'; }

    function exportLogs(){
      const logs = {
        timestamp: new Date().toISOString(),
        metrics, demo: 'functional'
      };
      const blob = new Blob([JSON.stringify(logs,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'qerrors-demo-logs.json'; a.click();
    }
    function resetMetrics(){ metrics.total=0; metrics.queue=0; metrics.cacheHits=0; metrics.aiRequests=0; updateMetricsUI(); clearErrorOutput(); clearCustomOutput(); clearAIOutput(); }

    // initial UI
    updateMetricsUI();
  </script>
</body>
</html>
