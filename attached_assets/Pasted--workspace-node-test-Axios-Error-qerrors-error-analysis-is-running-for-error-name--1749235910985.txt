~/workspace$ node --test
Axios Error
qerrors error analysis is running for
            error name: "NOTOKEN",
            error message: "no token", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
✔ analyzeError handles AxiosError gracefully (3.089229ms)
✔ analyzeError returns null without token (0.39784ms)
✖ analyzeError processes JSON response from API (0.57423ms)
  TypeError [Error]: stub is not a function
      at stubAxiosPost (/home/runner/workspace/test/analyzeError.test.js:28:10)
      at TestContext.<anonymous> (/home/runner/workspace/test/analyzeError.test.js:56:24)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✖ analyzeError handles JSON parse errors (0.35464ms)
  TypeError [Error]: stub is not a function
      at stubAxiosPost (/home/runner/workspace/test/analyzeError.test.js:28:10)
      at TestContext.<anonymous> (/home/runner/workspace/test/analyzeError.test.js:72:24)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✔ index exports qerrors and logger (1.85718ms)
✔ logger exposes standard logging methods (2.218619ms)
✖ qerrors logs and responds with json then calls next (1.74118ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:33:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at node:internal/test_runner/harness:255:12
      at node:internal/process/task_queues:140:7
      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
      at AsyncResource.runMicrotask (node:internal/process/task_queues:137:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)

✖ qerrors sends html when accept header requests it (0.21818ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:53:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✖ qerrors does nothing when headers already sent (0.22474ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:68:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✖ qerrors handles absence of req res and next (0.19976ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:85:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✖ qerrors calls next without res (0.209379ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:98:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

✖ qerrors exits if no error provided (0.20008ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:111:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

ℹ tests 12
ℹ suites 0
ℹ pass 4
ℹ fail 8
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 371.420009

✖ failing tests:

test at test/analyzeError.test.js:54:1
✖ analyzeError processes JSON response from API (0.57423ms)
  TypeError [Error]: stub is not a function
      at stubAxiosPost (/home/runner/workspace/test/analyzeError.test.js:28:10)
      at TestContext.<anonymous> (/home/runner/workspace/test/analyzeError.test.js:56:24)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/analyzeError.test.js:70:1
✖ analyzeError handles JSON parse errors (0.35464ms)
  TypeError [Error]: stub is not a function
      at stubAxiosPost (/home/runner/workspace/test/analyzeError.test.js:28:10)
      at TestContext.<anonymous> (/home/runner/workspace/test/analyzeError.test.js:72:24)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/qerrors.test.js:31:1
✖ qerrors logs and responds with json then calls next (1.74118ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:33:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at node:internal/test_runner/harness:255:12
      at node:internal/process/task_queues:140:7
      at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
      at AsyncResource.runMicrotask (node:internal/process/task_queues:137:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)

test at test/qerrors.test.js:52:1
✖ qerrors sends html when accept header requests it (0.21818ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:53:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/qerrors.test.js:67:1
✖ qerrors does nothing when headers already sent (0.22474ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:68:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/qerrors.test.js:83:1
✖ qerrors handles absence of req res and next (0.19976ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:85:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/qerrors.test.js:97:1
✖ qerrors calls next without res (0.209379ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:98:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)

test at test/qerrors.test.js:110:1
✖ qerrors exits if no error provided (0.20008ms)
  TypeError [Error]: stub is not a function
      at stubDeps (/home/runner/workspace/test/qerrors.test.js:22:25)
      at TestContext.<anonymous> (/home/runner/workspace/test/qerrors.test.js:111:19)
      at Test.runInAsyncScope (node:async_hooks:206:9)
      at Test.run (node:internal/test_runner/test:796:25)
      at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
      at Test.postRun (node:internal/test_runner/test:889:19)
      at Test.run (node:internal/test_runner/test:835:12)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7)