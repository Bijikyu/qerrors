@codex/express-error-handler
Purpose: Express error handling middleware with qerrors integration and fallback support.

Explanation:
This module provides a robust Express error handling middleware that integrates with the qerrors framework while providing comprehensive fallback support. It includes dynamic import handling for qerrors, consistent error response formatting, and graceful degradation when qerrors is unavailable. The middleware is particularly valuable for Express applications that need consistent error handling across different environments and deployment scenarios.

The error handler includes support for various error types, context-aware error reporting, and fallback mechanisms that ensure the application never crashes due to error handler failures.

/**
 * @file Error handling utilities using qerrors framework
 * @description Provides consistent error handling for controllers and services
 * 
 * Rationale:
 * - Centralizes error handling logic using qerrors
 * - Provides typed error handling for Express controllers
 * - Ensures consistent error responses across the application
 */
import type { Request, Response, NextFunction } from 'express';
/**
 * Handle controller errors consistently using qerrors
 * @param error - The error to handle
 * @param context - Context string for logging (e.g., function name)
 * @param res - Express response object
 * @param next - Express next function
 * @returns Promise that resolves after the response is written or the fallback handler completes.
 */
/**
 * Handle controller errors consistently using qerrors framework
 * Rationale: Centralizes error handling logic with fallback for environments without qerrors
 * Provides structured error responses with context information for debugging
 * Uses async/await pattern to handle dynamic import of qerrors module
 */
async function handleError(error:unknown,context:string,res:Response,next?:NextFunction):Promise<void>{
  try{
    // Dynamic import of qerrors for error handling
    const qerrors=await import('qerrors');
    
    // Use qerrors handleControllerError if available (preferred path)
    if(qerrors.handleControllerError){
      qerrors.handleControllerError(res,error as Error,context,{});
    }else{
      // Fallback to basic error response when qerrors function is not available
      const message=error instanceof Error?error.message:'Unknown error';
      res.status(500).json({error:message,context});
    }
  }catch{
    // Ultimate fallback if qerrors import fails or other errors occur
    // Rationale: Ensures the application never crashes due to error handler failures
    const message=error instanceof Error?error.message:'Unknown error';
    res.status(500).json({error:message,context});
  }
}
export { handleError };