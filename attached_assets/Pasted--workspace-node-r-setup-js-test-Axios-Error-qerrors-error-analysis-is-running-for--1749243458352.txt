~/workspace$ node -r ./setup.js --test
Axios Error
qerrors error analysis is running for
            error name: "NOTOKEN",
            error message: "no token", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors error analysis is running for
            error name: "TESTERR",
            error message: "test error", 
            with context: "test context"
qerrors is returning advice for 
                the error name: "TESTERR",
                with the error message: "test error", 
                with context: "test context"
TESTERR {"advice":"test advice"}
qerrors error analysis is running for
            error name: "PARSEERR",
            error message: "test error", 
            with context: "test context"
Problem parsing advice JSON for PARSEERR
Problem in analyzeError function of qerrors for PARSEERR: test error
✔ analyzeError handles AxiosError gracefully (3.329019ms)
✔ analyzeError returns null without token (0.38584ms)
✔ analyzeError processes JSON response from API (1.789849ms)
✔ analyzeError handles JSON parse errors (0.606019ms)
✔ index exports qerrors and logger (2.10324ms)
qerrors is running for error message: "boom", 
            with context: "spyCtx", 
            assigning it the unique error name: "ERROR: Error_1749243446212_d2omesqf7el"
2025-06-06 20:57:26 error: boom
Error: boom
    at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:32:15)
    at Test.runInAsyncScope (node:async_hooks:206:9)
    at Test.run (node:internal/test_runner/test:796:25)
    at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
    at node:internal/test_runner/harness:255:12
    at node:internal/process/task_queues:140:7
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at AsyncResource.runMicrotask (node:internal/process/task_queues:137:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446212_d2omesqf7el",
            error message: "boom", 
            with context: "spyCtx"
qerrors is returning advice for 
                the error name: "ERROR: Error_1749243446212_d2omesqf7el",
                with the error message: "boom", 
                with context: "spyCtx"
ERROR: Error_1749243446212_d2omesqf7el {"ok":true}
qerrors ran
✖ qerrors integration logs error and analyzes context (10.820409ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:42:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }

✔ logger exposes standard logging methods (2.03109ms)
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446230_zy4fph1sp4s"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446230_zy4fph1sp4s",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446234_2canak0dvup"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446234_2canak0dvup",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446235_dbqj6mly1uf"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446235_dbqj6mly1uf",
            error message: "not found", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446236_zzbxrfcmx9"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446236_zzbxrfcmx9",
            error message: "not found", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446237_d5tz7msjws9"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446237_d5tz7msjws9",
            error message: "boom", 
            with context: "ctx"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
qerrors is running for error message: "boom", 
            with context: "unknown context", 
            assigning it the unique error name: "ERROR: Error_1749243446238_g3klqn2b328"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446238_g3klqn2b328",
            error message: "boom", 
            with context: "unknown context"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243446238_s20yyssq0sl"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243446238_s20yyssq0sl",
            error message: "boom", 
            with context: "ctx"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
✔ qerrors logs and responds with json then calls next (4.928099ms)
✔ qerrors sends html when accept header requests it (0.74262ms)
✔ qerrors honors error.statusCode in json (0.85892ms)
✔ qerrors honors error.statusCode in html (0.94383ms)
✔ qerrors does nothing when headers already sent (0.922999ms)
✔ qerrors handles absence of req res and next (0.643639ms)
✔ qerrors calls next without res (0.48633ms)
✔ qerrors exits if no error provided (0.24853ms)
ℹ tests 15
ℹ suites 0
ℹ pass 14
ℹ fail 1
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 318.821462

✖ failing tests:

test at test/integration.qerrors.test.js:20:1
✖ qerrors integration logs error and analyzes context (10.820409ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:42:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }