~/workspace$ node -r ./setup.js --test
Axios Error
qerrors error analysis is running for
            error name: "NOTOKEN",
            error message: "no token", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors error analysis is running for
            error name: "TESTERR",
            error message: "test error", 
            with context: "test context"
qerrors is returning advice for 
                the error name: "TESTERR",
                with the error message: "test error", 
                with context: "test context"
TESTERR {"advice":"test advice"}
qerrors error analysis is running for
            error name: "PARSEERR",
            error message: "test error", 
            with context: "test context"
Problem parsing advice JSON for PARSEERR
Problem in analyzeError function of qerrors for PARSEERR: test error
✔ analyzeError handles AxiosError gracefully (4.443759ms)
✔ analyzeError returns null without token (0.67269ms)
✔ analyzeError processes JSON response from API (1.61861ms)
✔ analyzeError handles JSON parse errors (0.72296ms)
✔ index exports qerrors and logger (1.62595ms)
qerrors is running for error message: "boom", 
            with context: "spyCtx", 
            assigning it the unique error name: "ERROR: Error_1749243348691_q1oyo2puqij"
2025-06-06 20:55:48 error: boom
Error: boom
    at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:30:15)
    at Test.runInAsyncScope (node:async_hooks:206:9)
    at Test.run (node:internal/test_runner/test:796:25)
    at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
    at node:internal/test_runner/harness:255:12
    at node:internal/process/task_queues:140:7
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at AsyncResource.runMicrotask (node:internal/process/task_queues:137:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348691_q1oyo2puqij",
            error message: "boom", 
            with context: "spyCtx"
qerrors is returning advice for 
                the error name: "ERROR: Error_1749243348691_q1oyo2puqij",
                with the error message: "boom", 
                with context: "spyCtx"
ERROR: Error_1749243348691_q1oyo2puqij {"ok":true}
qerrors ran
✖ qerrors integration logs error and analyzes context (9.825428ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:40:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }

✔ logger exposes standard logging methods (18.033907ms)
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348704_empkgpuymst"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348704_empkgpuymst",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348707_wznjcnjc6c"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348707_wznjcnjc6c",
            error message: "boom", 
            with context: "ctx"
qerrors ran
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348708_4jiwyga3z2r"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348708_4jiwyga3z2r",
            error message: "not found", 
            with context: "ctx"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
Missing OPENAI_TOKEN in environment variables.
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348709_6odhqps1hm8"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348709_6odhqps1hm8",
            error message: "not found", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348709_marz5m1wjl"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348709_marz5m1wjl",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "unknown context", 
            assigning it the unique error name: "ERROR: Error_1749243348710_n3yqq28j8f"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348710_n3yqq28j8f",
            error message: "boom", 
            with context: "unknown context"
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243348711_svvxmj7l"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243348711_svvxmj7l",
            error message: "boom", 
            with context: "ctx"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
Missing OPENAI_TOKEN in environment variables.
✔ qerrors logs and responds with json then calls next (3.870659ms)
✔ qerrors sends html when accept header requests it (0.63254ms)
✔ qerrors honors error.statusCode in json (0.698379ms)
✔ qerrors honors error.statusCode in html (0.67445ms)
✔ qerrors does nothing when headers already sent (0.63799ms)
✔ qerrors handles absence of req res and next (0.62435ms)
✔ qerrors calls next without res (0.409ms)
✔ qerrors exits if no error provided (0.21678ms)
ℹ tests 15
ℹ suites 0
ℹ pass 14
ℹ fail 1
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 330.610999

✖ failing tests:

test at test/integration.qerrors.test.js:20:1
✖ qerrors integration logs error and analyzes context (9.825428ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:40:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }