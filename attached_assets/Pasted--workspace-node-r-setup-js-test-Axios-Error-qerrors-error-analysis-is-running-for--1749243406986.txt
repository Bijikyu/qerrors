~/workspace$ node -r ./setup.js --test
Axios Error
qerrors error analysis is running for
            error name: "NOTOKEN",
            error message: "no token", 
            with context: "ctx"
qerrors error analysis is running for
            error name: "TESTERR",
            error message: "test error", 
            with context: "test context"
Missing OPENAI_TOKEN in environment variables.
qerrors is returning advice for 
                the error name: "TESTERR",
                with the error message: "test error", 
                with context: "test context"
TESTERR {"advice":"test advice"}
qerrors error analysis is running for
            error name: "PARSEERR",
            error message: "test error", 
            with context: "test context"
Problem parsing advice JSON for PARSEERR
Problem in analyzeError function of qerrors for PARSEERR: test error
✔ analyzeError handles AxiosError gracefully (3.748369ms)
✔ analyzeError returns null without token (0.81282ms)
✔ analyzeError processes JSON response from API (3.208879ms)
✔ analyzeError handles JSON parse errors (0.57972ms)
✔ index exports qerrors and logger (1.570589ms)
qerrors is running for error message: "boom", 
            with context: "spyCtx", 
            assigning it the unique error name: "ERROR: Error_1749243396800_piwlc71s3vk"
2025-06-06 20:56:36 error: boom
Error: boom
    at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:33:15)
    at Test.runInAsyncScope (node:async_hooks:206:9)
    at Test.run (node:internal/test_runner/test:796:25)
    at Test.processPendingSubtests (node:internal/test_runner/test:527:18)
    at node:internal/test_runner/harness:255:12
    at node:internal/process/task_queues:140:7
    at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
    at AsyncResource.runMicrotask (node:internal/process/task_queues:137:8)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396800_piwlc71s3vk",
            error message: "boom", 
            with context: "spyCtx"
qerrors is returning advice for 
                the error name: "ERROR: Error_1749243396800_piwlc71s3vk",
                with the error message: "boom", 
                with context: "spyCtx"
ERROR: Error_1749243396800_piwlc71s3vk {"ok":true}
qerrors ran
✖ qerrors integration logs error and analyzes context (9.681199ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:43:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }

✔ logger exposes standard logging methods (2.1419ms)
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396803_ds3yzy3q1e4"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396803_ds3yzy3q1e4",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396807_nj6sw78j8se"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396807_nj6sw78j8se",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396808_9auik5kcft"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396808_9auik5kcft",
            error message: "not found", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "not found", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396809_gdzfplbue46"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396809_gdzfplbue46",
            error message: "not found", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396810_mvagjjif9va"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396810_mvagjjif9va",
            error message: "boom", 
            with context: "ctx"
Missing OPENAI_TOKEN in environment variables.
qerrors ran
qerrors is running for error message: "boom", 
            with context: "unknown context", 
            assigning it the unique error name: "ERROR: Error_1749243396812_hanea2z1yoq"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396812_hanea2z1yoq",
            error message: "boom", 
            with context: "unknown context"
qerrors ran
qerrors is running for error message: "boom", 
            with context: "ctx", 
            assigning it the unique error name: "ERROR: Error_1749243396813_h2dzlf51tw5"
qerrors error analysis is running for
            error name: "ERROR: Error_1749243396813_h2dzlf51tw5",
            error message: "boom", 
            with context: "ctx"
qerrors ran
Missing OPENAI_TOKEN in environment variables.
Missing OPENAI_TOKEN in environment variables.
✔ qerrors logs and responds with json then calls next (4.937639ms)
✔ qerrors sends html when accept header requests it (0.76362ms)
✔ qerrors honors error.statusCode in json (0.86422ms)
✔ qerrors honors error.statusCode in html (0.898019ms)
✔ qerrors does nothing when headers already sent (1.532929ms)
✔ qerrors handles absence of req res and next (0.64653ms)
✔ qerrors calls next without res (0.51698ms)
✔ qerrors exits if no error provided (0.26982ms)
ℹ tests 15
ℹ suites 0
ℹ pass 14
ℹ fail 1
ℹ cancelled 0
ℹ skipped 0
ℹ todo 0
ℹ duration_ms 319.714891

✖ failing tests:

test at test/integration.qerrors.test.js:20:1
✖ qerrors integration logs error and analyzes context (9.681199ms)
  AssertionError [ERR_ASSERTION]: Expected values to be strictly equal:
  + actual - expected
  
  + undefined
  - 'spyCtx'
      at TestContext.<anonymous> (/home/runner/workspace/test/integration.qerrors.test.js:43:10)
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async Test.run (node:internal/test_runner/test:797:9)
      at async Test.processPendingSubtests (node:internal/test_runner/test:527:7) {
    generatedMessage: true,
    code: 'ERR_ASSERTION',
    actual: undefined,
    expected: 'spyCtx',
    operator: 'strictEqual'
  }